{% extends "base/base.html" %}
{% load static %}

{% block content %}
    <link rel="stylesheet" href="{% static 'css/blog/blog_styles.css' %}">


    {% comment %} <svg style="display: none;">
        <symbol id="python" viewBox="0 0 100 100">
            <path d="M 24.5 2 C 15.800781 2 14 6.492188 14 9.09375 L 14 14 L 24 14 L 24 15 L 9.09375 15 C 5.792969 15 2 17.601563 2 25 C 2 32.398438 5.792969 35 9.09375 35 L 15 35 L 15 29 C 15 26.800781 16.800781 25 19 25 L 31 25 C 32.699219 25 34 23.699219 34 22 L 34 9.09375 C 34 5.59375 30.699219 2 24.5 2 Z M 20 7 C 21.101563 7 22 7.898438 22 9 C 22 10.101563 21.101563 11 20 11 C 18.898438 11 18 10.101563 18 9 C 18 7.898438 18.898438 7 20 7 Z M 35 15 L 35 22 C 35 24.199219 33.199219 26 31 26 L 19 26 C 17.300781 26 16 27.300781 16 29 L 16 40.90625 C 16 44.40625 19.300781 48 25.5 48 C 34.199219 48 36 43.507813 36 40.90625 L 36 36 L 26 36 L 26 35 L 40.90625 35 C 44.207031 35 48 32.398438 48 25 C 48 17.601563 44.207031 15 40.90625 15 Z M 30 39 C 31.101563 39 32 39.898438 32 41 C 32 42.101563 31.101563 43 30 43 C 28.898438 43 28 42.101563 28 41 C 28 39.898438 28.898438 39 30 39 Z"></path>
        </symbol>
        <symbol id="cpp" viewBox="0 0 100 100">
            <path d="M 43.910156 12.003906 L 27.070313 2.539063 C 25.792969 1.824219 24.207031 1.824219 22.929688 2.539063 L 6.089844 12.003906 C 4.800781 12.726563 4 14.082031 4 15.535156 L 4 34.464844 C 4 35.917969 4.800781 37.273438 6.089844 37.996094 L 22.929688 47.460938 C 23.570313 47.820313 24.285156 48 25 48 C 25.714844 48 26.429688 47.820313 27.070313 47.460938 L 43.910156 37.996094 C 45.199219 37.273438 46 35.917969 46 34.464844 L 46 15.535156 C 46 14.082031 45.199219 12.726563 43.910156 12.003906 Z M 25 37 C 18.382813 37 13 31.617188 13 25 C 13 18.382813 18.382813 13 25 13 C 28.78125 13 32.273438 14.753906 34.542969 17.742188 L 30.160156 20.277344 C 28.84375 18.835938 26.972656 18 25 18 C 21.140625 18 18 21.140625 18 25 C 18 28.859375 21.140625 32 25 32 C 26.972656 32 28.84375 31.164063 30.160156 29.722656 L 34.542969 32.257813 C 32.273438 35.246094 28.78125 37 25 37 Z M 37 26 L 35 26 L 35 28 L 33 28 L 33 26 L 31 26 L 31 24 L 33 24 L 33 22 L 35 22 L 35 24 L 37 24 Z M 44 26 L 42 26 L 42 28 L 40 28 L 40 26 L 38 26 L 38 24 L 40 24 L 40 22 L 42 22 L 42 24 L 44 24 Z"></path>
        </symbol>
        <symbol id="test" viewBox="0 0 16 16">
            <rect x="4" width="12" height="12" transform="translate(20 12) rotate(-180)" />
            <polygon points="2 14 2 2 0 2 0 14 0 16 2 16 14 16 14 14 2 14" />
        </symbol>
        <symbol id="other" viewBox="0 0 16 16">
            <polygon points="0.64 11.85 -0.02 11.1 2.55 8.85 4.57 10.4 9.25 5.25 12.97 8.84 15.37 6.79 16.02 7.54 12.94 10.2 9.29 6.68 4.69 11.76 2.59 10.14 0.64 11.85" />
        </symbol>
    </svg> {% endcomment %}


    <section id="main-blog">
        <div class="container container-flex">
            <main role="main">
                {% for article in tech_articles %}

                    {% if article.class_name == "article-featured" %}
                        <article class="article-featured">
                            <h2 class="article-title">{{ article.title }}</h2>
                            <img class="rounded-corners-25px featured-image" src="{{ article.image.url }}" alt="{{ article.title }}">
                            <p class="article-info">{{ article.date_published }}</p>
                            <p class="article-body">{{ article.body_snippet }}</p>
                            <a href="{% url 'tech_blog_detail' article.slug %}" class="article-read-more">Đọc thêm . . .</a>
                        </article>

                    {% else %}
                        <article class="article-recent">
                            <div class="article-recent-main">
                                <h2 class="article-title">{{ article.title }}</h2>
                                <p class="article-body">{{ article.body_snippet }}</p>
                                <a href="{% url 'tech_blog_detail' article.slug %}" class="article-read-more">Đọc thêm . . .</a>
                            </div>
                            <div class="article-recent-secondary">
                                <img class="rounded-corners-25px" src="{{ article.image.url }}" alt="{{ article.title }}">
                                <p class="article-info">{{ article.date_published }}</p>
                            </div>
                        </article>
                    {% endif %}

                {% endfor %}

            </main>

            <aside class="sidebar">
                <div class="sidebar-widget" data-section="about">
                    <h2 class="widget-title" id="display-title-about">VỀ MÌNH</h2>
                    <textarea id="editable-title-about" class="hidden">{{ about_content.title }}</textarea>

                    {% if about_content.image %}
                        <img id="display-img-about" class="rounded-corners-25px" src="{{ about_content.image.url }}" alt="About Image">
                    {% else %}
                        <img id="display-img-about" class="rounded-corners-25px" src="https://raw.githubusercontent.com/kevin-powell/reponsive-web-design-bootcamp/master/Module%202-%20A%20simple%20life/img/about-me.jpg" alt="About Image">
                    {% endif %}

                    <p id="display-content-about" class="widget-body">{{ about_content.content }}</p>
                    <textarea id="editable-content-about" class="hidden">{{ about_content.content }}</textarea>

                    {% if is_staff %}
                        <div class="update-buttons">
                            <button onclick="editContent('display-title-about', 'editable-title-about', 'update-title-about')">Update Title</button>
                            <button id="update-title-about" class="hidden" onclick="saveContent('editable-title-about', 'display-title-about')">Save Title</button>
                            <button onclick="editContent('display-content-about', 'editable-content-about', 'update-content-about')">Update Content</button>
                            <button id="update-content-about" class="hidden" onclick="saveContent('editable-content-about', 'display-content-about')">Save Content</button>
                        </div>
                        <input type="file" id="image-upload-about" class="hidden" onchange="previewImage(this, 'display-img-about')" />
                        <button onclick="document.getElementById('image-upload-about').click()">Update Image</button>
                        <button id="upload-button-about" class="hidden" onclick="uploadImage('image-upload-about', 'display-img-about')">Upload</button>
                    {% endif %}
                </div>

                <div class="sidebar-widget" data-section="techblog-types">
                    <h2 class="widget-title">LỌC</h2>
                    <div class="techblog-types-container">
                        {% for type, display_name in tech_blog_types %}
                            <div class="techblog-type" onclick="filterByType('{{ type }}')">
                                {% comment %} <svg class="techblog-type-icon">
                                    <use xlink:href="#{{ type }}"></use>
                                </svg> {% endcomment %}
                                {{ display_name }}
                            </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="sidebar-widget">
                    <h2 class="widget-title">BÀI VIẾT MỚI</h2>
                    {% for post in latest_tech_posts %}
                        <div class="widget-lastest-post">
                            <!-- Wrap the title with an anchor tag pointing to the post detail page -->
                            <h3 class="widget-lastest-post-title">
                                <a href="{% url 'tech_blog_detail' post.slug %}">{{ post.title }}</a>
                            </h3>
                            <img class="rounded-corners-25px widget-image" src="{{ post.image.url }}" alt="{{ post.title }}">
                        </div>
                    {% endfor %}
                </div>
            </aside>

        </div>

        {% if articles.paginator.num_pages > 1 %}
            <div class="container container-flex">
                <div class="pagination">
                    <span class="step-links">
                        {% if articles.has_previous %}
                            <a href="?page=1">&laquo; first</a>
                            <a href="?page={{ articles.previous_page_number }}">previous</a>
                        {% endif %}

                        <span class="current">
                            Page {{ articles.number }} of {{ articles.paginator.num_pages }}.
                        </span>

                        {% if articles.has_next %}
                            <a href="?page={{ articles.next_page_number }}">Next</a>
                            <a href="?page={{ articles.paginator.num_pages }}">Last &raquo;</a>
                        {% endif %}
                    </span>
                </div>
            </div>
        {% endif %}

    </section>

    <script src="{% static 'js/base/edit_content.js' %}"></script>

    <script>
        function filterByType(techType) {
            console.log("Filtering by tech type:", techType);

            // Make an AJAX call to fetch the filtered posts
            $.ajax({
                url: "/filter_tech_blog_posts/",
                type: "GET",
                data: { techType: techType },
                success: function(data) {
                    // Assuming the main tag is the container for all articles
                    const container = document.querySelector('main');
                    container.innerHTML = '';  // Clear current posts

                    // Loop through the returned data to construct and display posts
                    data.forEach(post => {
                        const article = document.createElement('article');
                        article.className = post.class_name;  // e.g., "article-featured" or "article-recent"

                        // Construct the innerHTML of the article based on your template structure and the returned post data
                        article.innerHTML = `
                            <h2 class="article-title">${post.title}</h2>
                            <img class="rounded-corners-25px featured-image" src="${post.image_url}" alt="${post.title}">
                            <p class="article-info">${post.date_published}</p>
                            <p class="article-body">${post.body_snippet}</p>
                            <a href="/tech_blog/${post.slug}" class="article-read-more">Đọc thêm . . .</a>
                        `;

                        container.appendChild(article);
                    });
                }
            });
        }

    </script>

{% endblock %}
